<div id='app'></div>
<script>
class myComponent{
    constructor(options){
        this.options = options
        Object.keys(options).forEach(key => {
            this[key] = options[key]
        })
        Object.keys(this.methods).forEach(key => {
            this[key] = this.methods[key]
        })
        this.render()
    }
    setState(data){        
        this.data = data
        this.render()
    }
    render(){
        console.log(this.data.count);
        this.el = templateToDom(this.options.template, this)
        const app = document.getElementById(this.id)
        app.innerHTML = ''
        app.appendChild(this.el)
    }
}

const myApp = new myComponent({
    id: 'app',
    data: {
        count: 0
    },
    template: `
        <div>
            <div>{{data.count}}</div>
            <button :onclick="addCount">button</button>
        </div>
    `,
    methods:{
        addCount(){
            const count = this.data.count + 1
            this.setState({
                count
            })
        }
    }
})

function templateToDom(template, app){
    const ast = parse(template, app)
    const root = createDom(ast, app)
    return root
}
function parse(template, app){
    return {
        tag: 'div',
        children: [{
            tag: 'div',
            textContent: `${app.data.count}`
        },{
            tag: 'button',
            textContent: 'button',
            events:{
                click: 'addCount'
            }
        }]
    }
}
function createDom(ast, app){
    let root = document.createElement(ast.tag)
    if(ast.textContent){
        root.textContent = ast.textContent
    }
    if(ast.children){
        ast.children.forEach(child => {
            root.appendChild(createDom(child, app))
        })
    }
    if(ast.events){
        Object.keys(ast.events).forEach(event => {
            root.addEventListener(event, app[ast.events[event]].bind(app))
        })
    }
    return root
}

</script>